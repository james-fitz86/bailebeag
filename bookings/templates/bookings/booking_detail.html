{% extends "config/base.html" %}
{% load crispy_forms_tags %}

{% block title %}Booking Detail{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Booking Details</h2>

    <div class="row mt-3">
        <div class="col-md-8">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ booking.pitch.name }}</h5>
                    <p class="card-text">
                        <strong>Date:</strong> {{ booking.start_time|date:"Y-m-d" }}<br>
                        <strong>Time:</strong> {{ booking.start_time|time:"H:i" }} â€“ {{ booking.end_time|time:"H:i" }}<br>
                        <strong>Booked By:</strong>
                        {% if booking.created_by %}
                            {{ booking.created_by.get_full_name }}
                        {% else %}
                            {{ booking.name }}
                        {% endif %}<br>
                        <strong>Role:</strong>
                        {% if booking.created_by %}
                            {{ booking.created_by.role|title }}
                        {% else %}
                            Public User
                        {% endif %}<br>
                        <strong>Email:</strong> {{ booking.email }}<br>
                        <strong>Method:</strong> {{ booking.get_method_display }}
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">Status Actions</h5>

                    <p><strong>Status:</strong>
                        {% if booking.status == 'approved' %}
                            <span class="badge bg-success">Approved</span>
                        {% elif booking.status == 'pending' %}
                            <span class="badge bg-warning text-dark">Pending</span>
                        {% elif booking.status == 'rejected' %}
                            <span class="badge bg-danger">Rejected</span>
                        {% elif booking.status == 'conflicting' %}
                            <span class="badge bg-info text-dark">Conflicting</span>
                        {% else %}
                            {{ booking.status }}
                        {% endif %}
                    </p>

                    {% if user.is_authenticated and user.role == "manager" and booking.status == "pending" and "Astro" in booking.pitch.name %}
                        <form method="post" action="{% url 'booking_approve' booking.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success w-100 mb-2">Approve</button>
                        </form>
                        <form method="post" action="{% url 'booking_reject' booking.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger w-100">Reject</button>
                        </form>
                    {% endif %}
                    {% if user.is_authenticated and user.role in "chairman secretary" and booking.status == "conflicting" %}
                        <form method="post" action="{% url 'booking_approve' booking.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success w-100 mb-2">Approve</button>
                        </form>
                        <form method="post" action="{% url 'booking_reject' booking.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger w-100">Reject</button>
                        </form>
                    {% endif %}

                </div>
            </div>
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">Alter Booking</h5>
                    <div class="mt-3">
                        <a href="{% url 'booking_update' object.id %}" class="btn btn-primary w-100 mb-2">Update</a>
                        <a href="{% url 'booking_delete' object.id %}" class="btn btn-danger w-100 mb-2">Delete</a>
                        <a href="{% url 'booking_list' %}" class="btn btn-secondary w-100">Back to Bookings</a>
                    </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}